# Manual deployment pipeline for production
name: Deploy to Production
on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to deploy'
        required: true
        default: 'main'
        type: string

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    environment: production
    concurrency: 
      group: deploy-production
      cancel-in-progress: false
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch }}
      
      - name: Setup Flyctl
        uses: superfly/flyctl-actions/setup-flyctl@master
          
      - name: Deploy to production
        run: flyctl deploy --remote-only
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
          
      - name: Deployment summary
        run: |
          echo "üöÄ Successfully deployed to production"
          echo "üìù Branch: ${{ inputs.branch }}"
          echo "üîó App URL: https://$(flyctl info --json | jq -r '.Hostname')"
